<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khảo sát Nghiên cứu Khoa học</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        fieldset {
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1 id="survey-title">Khảo sát Nghiên cứu Khoa học</h1>

    <!-- Phần khảo sát -->
    <div id="survey-form-container">
        <form id="survey-form">
            <fieldset>
                <legend>1. Doanh nghiệp của bạn có bao nhiêu nhân sự?</legend>
                <input type="number" name="question1" required>
            </fieldset>
            <!-- Thêm các câu hỏi khác tại đây -->
            <button type="submit">Gửi Khảo sát</button>
        </form>
    </div>

    <!-- Phần preview -->
    <div id="preview-container" style="display: none;">
        <h1>Preview Khảo Sát</h1>
        <table id="preview-table">
            <thead>
                <tr>
                    <th>Câu Hỏi</th>
                    <th>Câu Trả Lời</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sẽ được chèn vào đây bằng JavaScript -->
            </tbody>
        </table>
        <button id="download-file">Tải Xuống File</button>
        <button id="send-email">Gửi Email</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const questions = {
                'question1': 'Doanh nghiệp của bạn có bao nhiêu nhân sự?',
                // Thêm các câu hỏi khác tại đây
            };

            // Xử lý form gửi khảo sát
            document.getElementById('survey-form').addEventListener('submit', function(event) {
                event.preventDefault();
                
                const formData = new FormData(event.target);
                const params = new URLSearchParams();
                
                for (const [key, value] of formData.entries()) {
                    params.append(key, value);
                }

                document.getElementById('survey-form-container').style.display = 'none';
                document.getElementById('preview-container').style.display = 'block';

                const tableBody = document.querySelector('#preview-table tbody');
                let fileContent = '';
                let emailBody = '';

                for (const [key, question] of Object.entries(questions)) {
                    const answer = params.get(key);
                    if (answer) {
                        const row = document.createElement('tr');
                        const questionCell = document.createElement('td');
                        const answerCell = document.createElement('td');
                        questionCell.textContent = question;
                        answerCell.textContent = answer;
                        row.appendChild(questionCell);
                        row.appendChild(answerCell);
                        tableBody.appendChild(row);

                        fileContent += `${question}\n${answer}\n\n`;
                        emailBody += `<tr><td>${question}</td><td>${answer}</td></tr>`;
                    }
                }

                emailBody = `
                    <h1>Kết quả Khảo sát</h1>
                    <table border="1" cellspacing="0" cellpadding="5">
                        <tr><th>Câu Hỏi</th><th>Câu Trả Lời</th></tr>
                        ${emailBody}
                    </table>
                `;

                document.getElementById('download-file').addEventListener('click', function() {
                    const blob = new Blob([fileContent], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'answers.txt';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                });

                document.getElementById('send-email').addEventListener('click', function() {
                    const subject = encodeURIComponent('Kết quả Khảo sát');
                    const body = encodeURIComponent(`Dưới đây là kết quả khảo sát:\n\n${fileContent}`);
                    window.location.href = `mailto:trungxcpro@gmail.com?subject=${subject}&body=${body}`;
                });
            });
        });
    </script>
</body>
</html>
